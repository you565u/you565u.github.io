var d=r=>{throw TypeError(r)};var v=(r,t,n)=>t.has(r)||d("Cannot "+n);var f=(r,t,n)=>t.has(r)?d("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,n);var o=(r,t,n)=>(v(r,t,"access private method"),n);import{g as E}from"./_commonjsHelpers-BosuxZz1.js";function b(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}var h,m;function T(){var t,p,w,g,c,k,y;if(m)return h;m=1;class r{constructor(e=null){f(this,t);this.url=e||o(this,t,y).call(this),this.queue=[],this.lock=!1,this.initialized=!1,this.initBuffer=[],this.processing=!1}async acquire(e=5e3){const i=Date.now();for(;this.lock;){if(Date.now()-i>e){console.error("Lock acquisition timeout"),this.lock=!1;break}await new Promise(a=>setTimeout(a,10))}this.lock=!0}release(){this.lock=!1}async enqueue(e){if(!this.initialized){this.initBuffer.push(e);return}this.queue.push(e),this.processing||await this.processQueue()}async processQueue(){if(!this.processing){await this.acquire();try{for(this.processing=!0;this.queue.length>0;){const e=this.queue.shift();try{await e()}catch(i){console.error("Error processing tracktor event:",e,i)}}}finally{this.processing=!1,this.release()}}}initialize(e){if(!o(this,t,p).call(this,e))throw new Error("Tracktor - invalid UUID");this.uuid=e,this.iframe=document.createElement("iframe"),this.iframe.width="1",this.iframe.height="1",this.iframe.style.border="0",this.iframe.onload=async()=>{this.initialized=!0;for(const i of this.initBuffer)await this.enqueue(i);this.initBuffer=[]},this.iframe.onerror=()=>{throw new Error("Tracktor Iframe failed to load")},this.iframe.src=this.url,document.body.appendChild(this.iframe)}async pageView(e,i,a){let s={uuid:this.uuid,data:e,url:window.location.href,related_uuid:a,referrer:document.referrer};return i&&(s.segments=i),this.enqueue(()=>this.postMessage(this.uuid,"recordVisit",s))}async postMessage(e,i,a){if(!this.iframe||!this.uuid)throw new Error("Tracktor not initialized properly");const s={type:i,detail:a};this.iframe.contentWindow.postMessage(s,"*")}async recordEmail(e){if(o(this,t,w).call(this,e))return this.enqueue(()=>this.postMessage(this.uuid,"recordEmail",{uuid:this.uuid,email:e}))}async recordPhone(e){if(o(this,t,g).call(this,e))return this.enqueue(()=>this.postMessage(this.uuid,"recordPhone",{uuid:this.uuid,phone:e}))}}return t=new WeakSet,p=function(e){const i=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;return o(this,t,c).call(this,i,e)},w=function(e){const i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/;return o(this,t,c).call(this,i,e)},g=function(e){const i=/^(\+\d{1,3}[-\s]?)?\(?[0-9]{3}\)?[-\s]?[0-9]{3}[-\s]?[0-9]{4}$/;return o(this,t,c).call(this,i,e)},c=function(e,i){return typeof i!="string"?!1:e.test(i.trim())},k=function(){const i=window.location.hostname.split("."),a=new Set([".co.uk",".com.au",".co.jp",".co.in",".com.br",".com.mx"]);for(let s=0;s<i.length-1;s++){const q="."+i.slice(s).join(".");if(a.has(q))return i.slice(s-1).join(".")}return i.slice(-2).join(".")},y=function(){const e=window.location.protocol,i=o(this,t,k).call(this);return"".concat(e,"//tracktor.").concat(i)},h=r,h}var D=T();const x=E(D),l=new x;window.addEventListener("load",function(){const r=document.querySelector('input[name="email"]');r&&r.addEventListener("change",function(){l.recordEmail(r.value).catch(u=>console.error(u))});const t=document.querySelector('input[name="_phone_number"]'),n=document.querySelector('input[name="phone_number"]');t&&n&&t.addEventListener("change",function(){l.recordPhone(n.value).catch(u=>console.error(u))})});window.tracktor=l;window.dispatchEvent(new Event("tracktor:init"));export{b as __vite_legacy_guard};
